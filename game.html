<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Jardim do Amor üåπ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: 'Comic Sans MS', 'Arial', sans-serif;
            background: linear-gradient(180deg, #87CEEB 0%, #98D8C8 100%);
            overflow-x: hidden;
            touch-action: pan-y;
            -webkit-overflow-scrolling: touch;
            position: fixed;
            width: 100%;
            height: 100vh;
            overscroll-behavior: none;
        }

        .game-container {
            max-width: 480px;
            margin: 0 auto;
            background: linear-gradient(180deg, #E8F5E9 0%, #FFF9C4 100%);
            height: 100vh;
            height: -webkit-fill-available;
            position: relative;
            box-shadow: 0 0 30px rgba(0,0,0,0.2);
            overflow-y: auto;
            overflow-x: hidden;
            -webkit-overflow-scrolling: touch;
        }

        /* Header */
        .header {
            background: linear-gradient(135deg, #FF6B9D 0%, #FEC163 100%);
            padding: 20px;
            color: white;
            text-align: center;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            border-bottom: 4px solid #FF1744;
        }

        .header h1 {
            font-size: 28px;
            margin-bottom: 12px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            letter-spacing: 1px;
        }

        .stats {
            display: flex;
            justify-content: space-around;
            margin-top: 12px;
        }

        .stat {
            background: rgba(255,255,255,0.3);
            padding: 10px 18px;
            border-radius: 25px;
            font-size: 16px;
            font-weight: bold;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
            border: 2px solid rgba(255,255,255,0.5);
        }

        /* Navigation */
        .nav-buttons {
            display: flex;
            background: linear-gradient(180deg, #FFF9C4 0%, #FFFDE7 100%);
            border-bottom: 3px solid #FBC02D;
            position: -webkit-sticky;
            position: sticky;
            top: 122px;
            z-index: 99;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .nav-btn {
            flex: 1;
            padding: 16px;
            border: none;
            background: transparent;
            font-size: 15px;
            cursor: pointer;
            transition: all 0.3s;
            border-bottom: 4px solid transparent;
            font-weight: bold;
            color: #5D4037;
        }

        .nav-btn.active {
            border-bottom: 4px solid #FF6B9D;
            color: #FF1744;
            background: rgba(255,107,157,0.1);
        }

        /* Garden */
        .garden {
            padding: 25px;
            background: linear-gradient(180deg, #C8E6C9 0%, #A5D6A7 100%);
            min-height: calc(100vh - 250px);
        }

        .garden-title {
            text-align: center;
            font-size: 22px;
            color: #2E7D32;
            margin-bottom: 20px;
            text-shadow: 2px 2px 4px rgba(255,255,255,0.8);
            font-weight: bold;
        }

        .plots-container {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 18px;
            max-width: 400px;
            margin: 0 auto;
        }

        .plot {
            aspect-ratio: 1;
            background: linear-gradient(135deg, #6D4C41 0%, #8D6E63 100%);
            border: 4px solid #4E342E;
            border-radius: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            position: relative;
            transition: transform 0.2s, box-shadow 0.2s;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3), inset 0 -2px 8px rgba(0,0,0,0.3);
        }

        .plot:active {
            transform: scale(0.95);
            box-shadow: 0 2px 6px rgba(0,0,0,0.3);
        }

        /* iOS Safari fix for touch */
        @media (hover: none) and (pointer: coarse) {
            .plot {
                -webkit-tap-highlight-color: transparent;
            }
        }

        .plot.empty {
            background: linear-gradient(135deg, #8D6E63 0%, #A1887F 100%);
            border: 4px dashed #5D4037;
        }

        .plot.empty::before {
            content: 'üå±';
            font-size: 35px;
            opacity: 0.4;
            filter: drop-shadow(2px 2px 4px rgba(0,0,0,0.3));
        }

        .plot.empty::after {
            content: 'Plantar';
            position: absolute;
            bottom: 15px;
            font-size: 12px;
            color: #5D4037;
            font-weight: bold;
            opacity: 0.6;
        }

        .flower {
            font-size: 55px;
            animation: grow 0.5s ease-out;
            filter: drop-shadow(3px 3px 6px rgba(0,0,0,0.3));
            margin-bottom: 8px;
        }

        @keyframes grow {
            from {
                transform: scale(0) rotate(-180deg);
                opacity: 0;
            }
            to {
                transform: scale(1) rotate(0deg);
                opacity: 1;
            }
        }

        .progress-bar {
            width: 85%;
            height: 12px;
            background: rgba(78, 52, 46, 0.4);
            border-radius: 15px;
            margin-top: 8px;
            overflow: hidden;
            border: 2px solid #4E342E;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.3);
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #4CAF50, #8BC34A, #CDDC39);
            transition: width 0.3s ease;
            border-radius: 15px;
            box-shadow: 0 0 10px rgba(76, 175, 80, 0.6);
        }

        .water-btn {
            position: absolute;
            top: -12px;
            right: -12px;
            background: linear-gradient(135deg, #2196F3, #03A9F4);
            color: white;
            border: 3px solid #0D47A1;
            border-radius: 50%;
            width: 42px;
            height: 42px;
            font-size: 20px;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(33, 150, 243, 0.5);
            z-index: 10;
            transition: transform 0.2s;
        }

        .water-btn:active {
            transform: scale(0.85);
        }

        .water-btn:focus {
            outline: none;
        }

        .harvest-btn {
            position: absolute;
            bottom: -12px;
            right: -12px;
            background: linear-gradient(135deg, #FF9800, #FFC107);
            color: white;
            border: 3px solid #E65100;
            border-radius: 50%;
            width: 42px;
            height: 42px;
            font-size: 20px;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(255, 152, 0, 0.5);
            animation: pulse 1.5s infinite;
            z-index: 10;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.15); box-shadow: 0 4px 20px rgba(255, 152, 0, 0.8); }
        }

        .needs-water-indicator {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 40px;
            animation: shake 0.5s infinite;
        }

        @keyframes shake {
            0%, 100% { transform: translate(-50%, -50%) rotate(-5deg); }
            50% { transform: translate(-50%, -50%) rotate(5deg); }
        }

        /* Shop */
        .shop {
            padding: 25px;
            display: none;
            background: linear-gradient(180deg, #FFF9C4 0%, #FFFDE7 100%);
            min-height: calc(100vh - 250px);
        }

        .shop.active {
            display: block;
        }

        .shop-item {
            background: linear-gradient(135deg, #FFFFFF 0%, #FFF9E6 100%);
            padding: 18px;
            margin-bottom: 18px;
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            box-shadow: 0 4px 15px rgba(0,0,0,0.15);
            border: 3px solid #FBC02D;
            transition: transform 0.2s;
        }

        .shop-item:active {
            transform: scale(0.98);
        }

        .shop-item-info {
            display: flex;
            align-items: center;
            gap: 18px;
        }

        .shop-item-icon {
            font-size: 50px;
            filter: drop-shadow(2px 2px 4px rgba(0,0,0,0.2));
        }

        .shop-item-details h3 {
            color: #5D4037;
            margin-bottom: 6px;
            font-size: 18px;
        }

        .shop-item-details p {
            color: #8D6E63;
            font-size: 13px;
            font-weight: bold;
        }

        .buy-btn {
            background: linear-gradient(135deg, #FF6B9D 0%, #FEC163 100%);
            color: white;
            border: 3px solid #FF1744;
            padding: 12px 22px;
            border-radius: 25px;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(255, 107, 157, 0.4);
            font-size: 15px;
            transition: transform 0.2s;
        }

        .buy-btn:active {
            transform: scale(0.95);
        }

        .buy-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            background: #9E9E9E;
            border-color: #616161;
        }

        /* Missions */
        .missions {
            padding: 25px;
            display: none;
            background: linear-gradient(180deg, #E1F5FE 0%, #B3E5FC 100%);
            min-height: calc(100vh - 250px);
        }

        .missions.active {
            display: block;
        }

        .mission-card {
            background: white;
            padding: 20px;
            margin-bottom: 18px;
            border-radius: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.15);
            border-left: 6px solid #FF6B9D;
            transition: transform 0.2s;
        }

        .mission-card:active {
            transform: scale(0.98);
        }

        .mission-card.completed {
            border-left-color: #4CAF50;
            background: linear-gradient(135deg, #E8F5E9 0%, #C8E6C9 100%);
        }

        .mission-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .mission-title {
            font-weight: bold;
            color: #333;
            font-size: 16px;
        }

        .mission-reward {
            background: linear-gradient(135deg, #FFE082 0%, #FFD54F 100%);
            padding: 6px 14px;
            border-radius: 15px;
            font-size: 13px;
            color: #F57F17;
            font-weight: bold;
            border: 2px solid #FBC02D;
        }

        .mission-progress {
            color: #666;
            font-size: 14px;
            margin-bottom: 12px;
        }

        .mission-progress-bar {
            width: 100%;
            height: 14px;
            background: #E0E0E0;
            border-radius: 15px;
            overflow: hidden;
            border: 2px solid #BDBDBD;
        }

        .mission-progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #FF6B9D, #FEC163);
            transition: width 0.5s;
        }

        /* Album */
        .album {
            padding: 25px;
            display: none;
            background: linear-gradient(180deg, #F3E5F5 0%, #E1BEE7 100%);
            min-height: calc(100vh - 250px);
        }

        .album.active {
            display: block;
        }

        .album-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 18px;
            max-width: 400px;
            margin: 0 auto;
        }

        .photo-slot {
            aspect-ratio: 1;
            background: white;
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            border: 4px solid #CE93D8;
        }

        .photo-slot.locked {
            background: linear-gradient(135deg, #E0E0E0 0%, #BDBDBD 100%);
        }

        .photo-slot.locked::before {
            content: 'üîí';
            font-size: 45px;
            filter: drop-shadow(2px 2px 4px rgba(0,0,0,0.3));
        }

        .photo-slot img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            image-rendering: auto;
            -webkit-user-select: none;
            user-select: none;
        }

        .photo-caption {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(0deg, rgba(0,0,0,0.8) 0%, transparent 100%);
            color: white;
            padding: 12px;
            font-size: 13px;
            text-align: center;
            font-weight: bold;
        }

        /* Cats */
        .cats-container {
            position: fixed;
            bottom: 80px;
            left: 0;
            right: 0;
            pointer-events: none;
            z-index: 50;
            max-width: 480px;
            margin: 0 auto;
        }

        .cat {
            position: absolute;
            font-size: 45px;
            animation: walk 12s linear;
            pointer-events: all;
            cursor: pointer;
            filter: drop-shadow(3px 3px 6px rgba(0,0,0,0.4));
            transition: transform 0.2s;
        }

        .cat:active {
            transform: scale(1.3);
        }

        .cat-label {
            position: absolute;
            top: -25px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(255,255,255,0.95);
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: bold;
            color: #FF6B9D;
            border: 2px solid #FF6B9D;
            white-space: nowrap;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
            opacity: 0;
            pointer-events: none;
        }

        .cat-label.show {
            opacity: 1;
        }

        @keyframes walk {
            0% {
                left: -60px;
            }
            100% {
                left: calc(100% + 60px);
            }
        }

        /* Special Events */
        .event-popup {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0);
            background: linear-gradient(135deg, #FFE082 0%, #FFD54F 100%);
            padding: 30px;
            border-radius: 25px;
            box-shadow: 0 10px 50px rgba(0,0,0,0.4);
            z-index: 1000;
            text-align: center;
            max-width: 320px;
            transition: transform 0.3s;
            border: 4px solid #F57F17;
        }

        .event-popup.show {
            transform: translate(-50%, -50%) scale(1);
        }

        .event-popup h2 {
            font-size: 24px;
            margin-bottom: 15px;
            color: #E65100;
        }

        .event-popup p {
            color: #5D4037;
            font-size: 16px;
            margin-bottom: 10px;
            font-weight: bold;
        }

        .event-popup button {
            background: linear-gradient(135deg, #FF6B9D 0%, #FEC163 100%);
            color: white;
            border: 3px solid #FF1744;
            padding: 14px 35px;
            border-radius: 25px;
            font-weight: bold;
            cursor: pointer;
            margin-top: 15px;
            font-size: 16px;
            box-shadow: 0 4px 12px rgba(255, 107, 157, 0.4);
        }

        /* Notification */
        .notification {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0);
            background: white;
            padding: 35px;
            border-radius: 25px;
            box-shadow: 0 10px 50px rgba(0,0,0,0.4);
            z-index: 1000;
            text-align: center;
            max-width: 320px;
            transition: transform 0.3s;
            border: 4px solid #FF6B9D;
        }

        .notification.show {
            transform: translate(-50%, -50%) scale(1);
        }

        .notification h2 {
            color: #FF6B9D;
            margin-bottom: 18px;
            font-size: 24px;
        }

        .notification p {
            color: #666;
            font-size: 16px;
            margin-bottom: 8px;
        }

        .notification button {
            background: linear-gradient(135deg, #FF6B9D 0%, #FEC163 100%);
            color: white;
            border: 3px solid #FF1744;
            padding: 14px 35px;
            border-radius: 25px;
            font-weight: bold;
            cursor: pointer;
            margin-top: 18px;
            font-size: 16px;
            box-shadow: 0 4px 12px rgba(255, 107, 157, 0.4);
        }

        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.6);
            z-index: 999;
            display: none;
        }

        .overlay.show {
            display: block;
        }

        /* Section titles */
        .section-title {
            font-size: 26px;
            color: #5D4037;
            margin-bottom: 22px;
            text-align: center;
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(255,255,255,0.8);
        }

        /* Plant menu */
        .plant-menu {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 25px;
            border-radius: 25px;
            box-shadow: 0 10px 50px rgba(0,0,0,0.4);
            z-index: 1001;
            max-width: 350px;
            width: 90%;
            border: 4px solid #FF6B9D;
            max-height: 80vh;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
        }

        .plant-menu h3 {
            margin-bottom: 20px;
            text-align: center;
            color: #FF6B9D;
            font-size: 22px;
        }

        .seed-option {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 14px;
            margin: 8px 0;
            background: linear-gradient(135deg, #FFFDE7 0%, #FFF9C4 100%);
            border-radius: 15px;
            border: 2px solid #FBC02D;
        }

        .seed-info {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .seed-icon {
            font-size: 32px;
            filter: drop-shadow(2px 2px 4px rgba(0,0,0,0.2));
        }

        .seed-details strong {
            display: block;
            color: #5D4037;
            font-size: 16px;
        }

        .seed-details small {
            font-size: 12px;
            color: #8D6E63;
            font-weight: bold;
        }

        .plant-seed-btn {
            background: linear-gradient(135deg, #FF6B9D 0%, #FEC163 100%);
            color: white;
            border: 2px solid #FF1744;
            padding: 10px 18px;
            border-radius: 15px;
            cursor: pointer;
            font-weight: bold;
            font-size: 14px;
        }

        .plant-seed-btn:disabled {
            background: #9E9E9E;
            border-color: #616161;
            opacity: 0.6;
        }

        .close-menu-btn {
            width: 100%;
            margin-top: 18px;
            background: #9E9E9E;
            color: white;
            border: 2px solid #616161;
            padding: 14px;
            border-radius: 15px;
            cursor: pointer;
            font-weight: bold;
            font-size: 15px;
        }
    </style>
</head>
<body>
    <div class="game-container">
        <div class="header">
            <h1>üåπ O Jardim de Alanna üåπ</h1>
            <div class="stats">
                <div class="stat">üí∞ <span id="coins">50</span></div>
                <div class="stat">üå∏ <span id="flowers">0</span></div>
                <div class="stat">üì∏ <span id="photos">0</span>/6</div>
            </div>
        </div>

        <div class="nav-buttons">
            <button class="nav-btn active" onclick="showSection('garden')">üå± Jardim</button>
            <button class="nav-btn" onclick="showSection('shop')">üõí Loja</button>
            <button class="nav-btn" onclick="showSection('missions')">üìã Miss√µes</button>
            <button class="nav-btn" onclick="showSection('album')">üì∏ √Ålbum</button>
        </div>

        <div id="garden-section" class="garden">
            <div class="garden-title">üåª Meu Jardim Especial üåª</div>
            <div class="plots-container" id="plots-container"></div>
        </div>

        <div id="shop-section" class="shop">
            <h2 class="section-title">üõí Loja de Sementes</h2>
            <div id="shop-items"></div>
        </div>

        <div id="missions-section" class="missions">
            <h2 class="section-title">üìã Miss√µes do Amor</h2>
            <div id="missions-list"></div>
        </div>

        <div id="album-section" class="album">
            <h2 class="section-title">üì∏ Nosso √Ålbum ‚ù§Ô∏è</h2>
            <div class="album-grid" id="album-grid"></div>
        </div>

        <div class="cats-container" id="cats-container"></div>
    </div>

    <div class="overlay" id="overlay"></div>
    <div class="notification" id="notification">
        <h2 id="notif-title"></h2>
        <p id="notif-message"></p>
        <button onclick="closeNotification()">OK</button>
    </div>

    <div class="event-popup" id="event-popup">
        <h2 id="event-title"></h2>
        <p id="event-message"></p>
        <button onclick="closeEventPopup()">Receber!</button>
    </div>

    <script>
        // Fix iOS viewport height
        function setVH() {
            let vh = window.innerHeight * 0.01;
            document.documentElement.style.setProperty('--vh', `${vh}px`);
        }
        
        setVH();
        window.addEventListener('resize', setVH);
        window.addEventListener('orientationchange', setVH);

        // Prevent iOS rubber band scroll
        document.addEventListener('touchmove', function(e) {
            if (e.target.closest('.game-container') || e.target.closest('.plant-menu')) {
                return;
            }
            e.preventDefault();
        }, { passive: false });

        // Game State
        const gameState = {
            coins: 100,
            flowersCollected: 0,
            flowersPlanted: 0,
            plots: Array(9).fill(null),
            unlockedPhotos: [],
            discoveredFlowers: [],
            foundMisa: false,
            foundMingau: false,
            missions: [
                { id: 1, title: "Primeira Flor", description: "Plante sua primeira flor", target: 1, progress: 0, reward: "photo1", completed: false, type: "plant" },
                { id: 2, title: "Jardineira Dedicada", description: "Plante 10 flores", target: 10, progress: 0, reward: "photo2", completed: false, type: "plant" },
                { id: 3, title: "Encontro com Misa", description: "Encontre a gatinha Misa", target: 1, progress: 0, reward: "photo3", completed: false, type: "misa" },
                { id: 4, title: "Visita do Mingau", description: "Encontre o anjinho Mingau", target: 1, progress: 0, reward: "photo4", completed: false, type: "mingau" },
                { id: 5, title: "Colecionadora Mestre", description: "Plante todos os tipos de flores", target: 10, progress: 0, reward: "photo5", completed: false, type: "allFlowers" },
                { id: 6, title: "Rosa Azul Especial", description: "Colha uma Rosa Azul", target: 1, progress: 0, reward: "photo6", completed: false, type: "blueRose" }
            ],
            catLastAppear: 0,
            growTimers: {},
            lastEventTime: 0,
            eventReward: 0,
            fertilizer: 0,
            wateringCan: true,
            goldWateringCan: false
        };

        // Flower types
        const flowers = {
            tulip: { name: "Tulipa", icon: "üå∑", growTime: 10, value: 5, cost: 3 },
            sunflower: { name: "Girassol", icon: "üåª", growTime: 15, value: 8, cost: 5 },
            rose: { name: "Rosa", icon: "üåπ", growTime: 20, value: 12, cost: 8 },
            daisy: { name: "Margarida", icon: "üåº", growTime: 12, value: 6, cost: 4 },
            hibiscus: { name: "Hibisco", icon: "üå∫", growTime: 18, value: 10, cost: 7 },
            blueRose: { name: "Rosa Azul üíô", icon: "üíô", growTime: 40, value: 50, cost: 30, special: true }
        };

        // Photos data - Suas fotos especiais!
        const photos = {
            photo1: { 
                url: "https://i.imgur.com/VwuNHlI.jpeg", 
                caption: "E a√≠, superman üôè - Onde tudo come√ßou ‚ù§Ô∏è"
            },
            photo2: { 
                url: "https://i.imgur.com/jqzUZwH.jpeg", 
                caption: "Nossos la√ßos entrela√ßados üíï"
            },
            photo3: { 
                url: "https://i.imgur.com/fo382Hg.jpeg", 
                caption: "Alanna e Misa üê± - Momento especial"
            },
            photo4: { 
                url: "https://i.imgur.com/5rgejm5.jpeg", 
                caption: "Mingau üòá - O anjinho branco üíº"
            },
            photo5: { 
                url: "https://i.imgur.com/9Boo3C9.jpeg", 
                caption: "Nosso futuro üåü"
            },
            photo6: { 
                url: "https://i.imgur.com/AmdW35j.jpeg", 
                caption: "A Filha da Lua üåô - Nossa hist√≥ria escrita"
            }
        };

        // Initialize game
        function init() {
            // Limpa qualquer timer anterior
            Object.keys(gameState.growTimers).forEach(key => {
                clearInterval(gameState.growTimers[key]);
            });
            
            // Reseta o estado do jogo
            gameState.coins = 100;
            gameState.flowersCollected = 0;
            gameState.flowersPlanted = 0;
            gameState.plots = Array(9).fill(null);
            gameState.unlockedPhotos = [];
            gameState.discoveredFlowers = [];
            gameState.foundMisa = false;
            gameState.foundMingau = false;
            gameState.catLastAppear = 0;
            gameState.growTimers = {};
            gameState.lastEventTime = 0;
            gameState.eventReward = 0;
            
            // Reseta as miss√µes
            gameState.missions.forEach(mission => {
                mission.progress = 0;
                mission.completed = false;
            });
            
            renderGarden();
            renderShop();
            renderMissions();
            renderAlbum();
            updateStats();
            startCatAnimation();
            startRandomEvents();
        }

        // Render garden
        function renderGarden() {
            const container = document.getElementById('plots-container');
            container.innerHTML = '';
            
            gameState.plots.forEach((plot, index) => {
                const plotDiv = document.createElement('div');
                plotDiv.className = 'plot';
                
                if (!plot) {
                    plotDiv.classList.add('empty');
                    plotDiv.addEventListener('click', () => showPlantMenu(index));
                    plotDiv.addEventListener('touchend', (e) => {
                        e.preventDefault();
                        showPlantMenu(index);
                    }, { passive: false });
                } else if (plot.needsWater) {
                    plotDiv.classList.remove('empty');
                    plotDiv.innerHTML = `
                        <div class="needs-water-indicator">üíß</div>
                        <div class="flower">${flowers[plot.type].icon}</div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: ${plot.progress}%"></div>
                        </div>
                        <button class="water-btn" onclick="waterPlant(${index}, event)" ontouchend="event.preventDefault(); waterPlant(${index}, event)">üíß</button>
                    `;
                } else if (plot.ready) {
                    plotDiv.classList.remove('empty');
                    plotDiv.innerHTML = `
                        <div class="flower">${flowers[plot.type].icon}</div>
                        <button class="harvest-btn" onclick="harvestPlant(${index}, event)" ontouchend="event.preventDefault(); harvestPlant(${index}, event)">‚úÇÔ∏è</button>
                    `;
                } else if (plot.growing) {
                    plotDiv.classList.remove('empty');
                    plotDiv.innerHTML = `
                        <div class="flower">${flowers[plot.type].icon}</div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: ${plot.progress}%"></div>
                        </div>
                    `;
                }
                
                container.appendChild(plotDiv);
            });
        }

        // Show plant menu
        function showPlantMenu(index) {
            const menu = document.createElement('div');
            menu.className = 'plant-menu';
            
            let html = '<h3>Escolha uma Semente üå±</h3>';
            
            Object.keys(flowers).forEach(key => {
                const flower = flowers[key];
                const canAfford = gameState.coins >= flower.cost;
                html += `
                    <div class="seed-option">
                        <div class="seed-info">
                            <div class="seed-icon">${flower.icon}</div>
                            <div class="seed-details">
                                <strong>${flower.name}</strong>
                                <small>üí∞ ${flower.cost} | ‚è±Ô∏è ${flower.growTime}s | üíµ +${flower.value}</small>
                            </div>
                        </div>
                        <button class="plant-seed-btn" onclick="plantSeed('${key}', ${index})" ${!canAfford ? 'disabled' : ''}>
                            Plantar
                        </button>
                    </div>
                `;
            });
            
            html += '<button class="close-menu-btn" onclick="closePlantMenu()">Fechar</button>';
            
            menu.innerHTML = html;
            menu.id = 'plant-menu';
            document.body.appendChild(menu);
            document.getElementById('overlay').classList.add('show');
            document.getElementById('overlay').onclick = closePlantMenu;
        }

        function closePlantMenu() {
            const menu = document.getElementById('plant-menu');
            if (menu) menu.remove();
            document.getElementById('overlay').classList.remove('show');
        }

        // Plant seed
        function plantSeed(type, index) {
            if (gameState.coins >= flowers[type].cost) {
                gameState.coins -= flowers[type].cost;
                gameState.plots[index] = {
                    type: type,
                    growing: true,
                    ready: false,
                    progress: 0,
                    needsWater: false,
                    watered: false,
                    plantedAt: Date.now()
                };
                
                closePlantMenu();
                updateStats();
                renderGarden();
                growPlant(index);
            }
        }

        // Grow plant
        function growPlant(index) {
            const plot = gameState.plots[index];
            if (!plot || !plot.growing) return;
            
            // Clear any existing timer
            if (gameState.growTimers[index]) {
                clearInterval(gameState.growTimers[index]);
            }
            
            const growTime = flowers[plot.type].growTime * 1000;
            const interval = 100;
            const increment = (interval / growTime) * 100;
            
            gameState.growTimers[index] = setInterval(() => {
                const currentPlot = gameState.plots[index];
                
                if (!currentPlot || !currentPlot.growing) {
                    clearInterval(gameState.growTimers[index]);
                    delete gameState.growTimers[index];
                    return;
                }
                
                currentPlot.progress += increment;
                
                // Need water at 50%
                if (currentPlot.progress >= 50 && currentPlot.progress < 52 && !currentPlot.watered) {
                    currentPlot.needsWater = true;
                    currentPlot.growing = false;
                    clearInterval(gameState.growTimers[index]);
                    delete gameState.growTimers[index];
                    renderGarden();
                    return;
                }
                
                if (currentPlot.progress >= 100) {
                    currentPlot.progress = 100;
                    currentPlot.growing = false;
                    currentPlot.ready = true;
                    clearInterval(gameState.growTimers[index]);
                    delete gameState.growTimers[index];
                    renderGarden();
                    return;
                }
                
                renderGarden();
            }, interval);
        }

        // Water plant
        function waterPlant(index, event) {
            event.stopPropagation();
            const plot = gameState.plots[index];
            if (plot && plot.needsWater) {
                plot.needsWater = false;
                plot.watered = true;
                plot.growing = true;
                renderGarden();
                growPlant(index);
            }
        }

        // Harvest plant
        function harvestPlant(index, event) {
            event.stopPropagation();
            const plot = gameState.plots[index];
            if (!plot || !plot.ready) return;
            
            const flower = flowers[plot.type];
            
            gameState.coins += flower.value;
            gameState.flowersCollected++;
            
            // Rastreia tipos de flores descobertas
            if (!gameState.discoveredFlowers.includes(plot.type)) {
                gameState.discoveredFlowers.push(plot.type);
            }
            
            // Clear timer if exists
            if (gameState.growTimers[index]) {
                clearInterval(gameState.growTimers[index]);
                delete gameState.growTimers[index];
            }
            
            // Update missions
            gameState.missions.forEach(mission => {
                if (!mission.completed) {
                    if (mission.type === 'blueRose' && plot.type === 'blueRose') {
                        mission.progress++;
                        if (mission.progress >= mission.target) {
                            mission.completed = true;
                            gameState.unlockedPhotos.push(mission.reward);
                            showNotification("Miss√£o Completa! üéâ", `Voc√™ colheu a Rosa Azul especial! Nova foto desbloqueada!`);
                        }
                    } else if (mission.type === 'plant') {
                        mission.progress++;
                        if (mission.progress >= mission.target) {
                            mission.completed = true;
                            gameState.unlockedPhotos.push(mission.reward);
                            showNotification("Miss√£o Completa! üéâ", `Voc√™ desbloqueou uma nova foto no √°lbum!`);
                        }
                    } else if (mission.type === 'allFlowers') {
                        // Verifica se j√° descobriu todos os 6 tipos
                        if (gameState.discoveredFlowers.length >= 6) {
                            mission.progress = gameState.discoveredFlowers.length;
                            mission.completed = true;
                            gameState.unlockedPhotos.push(mission.reward);
                            showNotification("Miss√£o Completa! üéâ", `Voc√™ plantou todos os tipos de flores! Nova foto desbloqueada!`);
                        } else {
                            mission.progress = gameState.discoveredFlowers.length;
                        }
                    }
                }
            });
            
            gameState.plots[index] = null;
            updateStats();
            renderGarden();
            renderMissions();
            renderAlbum();
        }

        // Render shop
        function renderShop() {
            const shop = document.getElementById('shop-items');
            shop.innerHTML = '';
            
            Object.keys(flowers).forEach(key => {
                const flower = flowers[key];
                const canAfford = gameState.coins >= flower.cost;
                
                const item = document.createElement('div');
                item.className = 'shop-item';
                item.innerHTML = `
                    <div class="shop-item-info">
                        <div class="shop-item-icon">${flower.icon}</div>
                        <div class="shop-item-details">
                            <h3>${flower.name}</h3>
                            <p>‚è±Ô∏è ${flower.growTime}s | üí∞ Vende por ${flower.value}</p>
                        </div>
                    </div>
                    <button class="buy-btn" ${!canAfford ? 'disabled' : ''}>
                        üí∞ ${flower.cost}
                    </button>
                `;
                shop.appendChild(item);
            });
        }

        // Render missions
        function renderMissions() {
            const missions = document.getElementById('missions-list');
            missions.innerHTML = '';
            
            gameState.missions.forEach(mission => {
                const card = document.createElement('div');
                card.className = 'mission-card' + (mission.completed ? ' completed' : '');
                card.innerHTML = `
                    <div class="mission-header">
                        <div class="mission-title">${mission.completed ? '‚úÖ' : 'üìã'} ${mission.title}</div>
                        <div class="mission-reward">üì∏ Foto</div>
                    </div>
                    <div class="mission-progress">${mission.description}</div>
                    <div class="mission-progress-bar">
                        <div class="mission-progress-fill" style="width: ${Math.min((mission.progress / mission.target) * 100, 100)}%"></div>
                    </div>
                    <div style="margin-top:10px;font-size:13px;color:#666;font-weight:bold;">
                        ${mission.progress}/${mission.target} ${mission.completed ? '‚ú® Completa!' : ''}
                    </div>
                `;
                missions.appendChild(card);
            });
        }

        // Render album
        function renderAlbum() {
            const album = document.getElementById('album-grid');
            album.innerHTML = '';
            
            Object.keys(photos).forEach(photoId => {
                const slot = document.createElement('div');
                slot.className = 'photo-slot';
                
                if (gameState.unlockedPhotos.includes(photoId)) {
                    const img = document.createElement('img');
                    img.src = photos[photoId].url;
                    img.alt = photos[photoId].caption;
                    img.crossOrigin = "anonymous";
                    img.onerror = function() {
                        // Se a imagem n√£o carregar, tenta sem crossOrigin
                        this.crossOrigin = null;
                        this.src = photos[photoId].url;
                    };
                    
                    const caption = document.createElement('div');
                    caption.className = 'photo-caption';
                    caption.textContent = photos[photoId].caption;
                    
                    slot.appendChild(img);
                    slot.appendChild(caption);
                } else {
                    slot.classList.add('locked');
                }
                
                album.appendChild(slot);
            });
        }

        // Cat animation
        function startCatAnimation() {
            setInterval(() => {
                // Aumentada frequ√™ncia: 40% de chance a cada 8 segundos
                if (Math.random() < 0.4 && Date.now() - gameState.catLastAppear > 10000) {
                    spawnCat();
                    gameState.catLastAppear = Date.now();
                }
            }, 8000);
        }

        function spawnCat() {
            const catsData = [
                { emoji: 'üêà', name: 'Misa', color: 'cinza' },
                { emoji: 'üòáüêà', name: 'Mingau üíº', color: 'branco', special: true }
            ];
            
            const catIndex = Math.floor(Math.random() * 2);
            const catData = catsData[catIndex];
            const bonus = catData.special ? Math.floor(Math.random() * 15) + 10 : Math.floor(Math.random() * 10) + 5;
            
            const cat = document.createElement('div');
            cat.className = 'cat';
            const label = '<div class="cat-label">' + catData.name + '</div>';
            cat.innerHTML = catData.emoji + label;
            cat.style.bottom = Math.random() * 80 + 20 + 'px';
            
            cat.onclick = () => handleCatClick(cat, catData, bonus);
            cat.ontouchend = (e) => {
                e.preventDefault();
                handleCatClick(cat, catData, bonus);
            };
            
            document.getElementById('cats-container').appendChild(cat);
            
            setTimeout(() => {
                if (cat.parentElement) cat.remove();
            }, 12000);
        }

        function handleCatClick(cat, catData, bonus) {
            // Mostra o nome ao clicar
            cat.querySelector('.cat-label').classList.add('show');
            
            gameState.coins += bonus;
            
            // Verifica se √© a primeira vez que encontra este gato
            let isMisa = catData.name === 'Misa';
            let isMingau = catData.special === true;
            
            // Atualiza as miss√µes de encontrar os gatos
            if (isMisa && !gameState.foundMisa) {
                gameState.foundMisa = true;
                gameState.missions.forEach(mission => {
                    if (mission.type === 'misa' && !mission.completed) {
                        mission.progress = 1;
                        mission.completed = true;
                        gameState.unlockedPhotos.push(mission.reward);
                        setTimeout(() => {
                            showNotification("Miss√£o Completa! üéâ", `Voc√™ encontrou Misa! Uma nova foto foi desbloqueada!`);
                            renderMissions();
                            renderAlbum();
                        }, 500);
                    }
                });
            }
            
            if (isMingau && !gameState.foundMingau) {
                gameState.foundMingau = true;
                gameState.missions.forEach(mission => {
                    if (mission.type === 'mingau' && !mission.completed) {
                        mission.progress = 1;
                        mission.completed = true;
                        gameState.unlockedPhotos.push(mission.reward);
                        setTimeout(() => {
                            showNotification("Miss√£o Completa! üéâ", `Voc√™ encontrou Mingau! Uma nova foto foi desbloqueada!`);
                            renderMissions();
                            renderAlbum();
                        }, 500);
                    }
                });
            }
            
            setTimeout(() => {
                showNotification(`${catData.name} trouxe um presente! üéÅ`, `+${bonus} moedas${catData.special ? ' üíº' : ''}`);
                updateStats();
                cat.remove();
            }, 300);
        }

        // Random Events System
        function startRandomEvents() {
            setInterval(() => {
                // 20% de chance a cada 20 segundos
                if (Math.random() < 0.2 && Date.now() - gameState.lastEventTime > 30000) {
                    triggerRandomEvent();
                    gameState.lastEventTime = Date.now();
                }
            }, 20000);
        }

        function triggerRandomEvent() {
            const events = [
                {
                    title: "üí™ Treino de For√ßa!",
                    message: "Voc√™ treinou pesado hoje! As flores cresceram com sua energia!",
                    effect: () => {
                        // Acelera o crescimento de todas as flores em crescimento
                        gameState.plots.forEach((plot, index) => {
                            if (plot && plot.growing) {
                                plot.progress += 15;
                                if (plot.progress >= 100) {
                                    plot.progress = 100;
                                    plot.growing = false;
                                    plot.ready = true;
                                }
                            }
                        });
                        renderGarden();
                        return 20;
                    }
                },
                {
                    title: "üî¥‚ö´ Vit√≥ria do Meng√£o!",
                    message: "O Flamengo ganhou! A sorte est√° ao seu lado!",
                    effect: () => {
                        const bonus = Math.floor(Math.random() * 30) + 20;
                        gameState.coins += bonus;
                        updateStats();
                        return bonus;
                    }
                },
                {
                    title: "üå≤ Di√°rio Perdido!",
                    message: "Voc√™ encontrou um di√°rio misterioso no jardim... Ele te deu algumas moedas!",
                    effect: () => {
                        const bonus = Math.floor(Math.random() * 25) + 15;
                        gameState.coins += bonus;
                        updateStats();
                        return bonus;
                    }
                },
                {
                    title: "üèãÔ∏è‚Äç‚ôÄÔ∏è Supino na Horta!",
                    message: "Sua for√ßa de academia ajudou a preparar novos canteiros! Ganhe um espa√ßo gr√°tis!",
                    effect: () => {
                        // Planta uma flor aleat√≥ria gr√°tis
                        const emptyPlots = gameState.plots.map((p, i) => p === null ? i : -1).filter(i => i !== -1);
                        if (emptyPlots.length > 0) {
                            const randomPlot = emptyPlots[Math.floor(Math.random() * emptyPlots.length)];
                            const flowerTypes = ['tulip', 'sunflower', 'rose', 'daisy', 'hibiscus'];
                            const randomFlower = flowerTypes[Math.floor(Math.random() * flowerTypes.length)];
                            
                            gameState.plots[randomPlot] = {
                                type: randomFlower,
                                growing: true,
                                ready: false,
                                progress: 0,
                                needsWater: false,
                                watered: false,
                                plantedAt: Date.now()
                            };
                            growPlant(randomPlot);
                            renderGarden();
                        }
                        return 0;
                    }
                },
                {
                    title: "üé© Bill Cipher Apareceu!",
                    message: "Ele fez um truque de m√°gica e multiplicou suas moedas!",
                    effect: () => {
                        const bonus = Math.floor(gameState.coins * 0.25);
                        gameState.coins += bonus;
                        updateStats();
                        return bonus;
                    }
                },
                {
                    title: "üåü Pato C√≥smico!",
                    message: "Um porquinho voador passou pelo jardim e deixou presentes!",
                    effect: () => {
                        const bonus = Math.floor(Math.random() * 40) + 30;
                        gameState.coins += bonus;
                        updateStats();
                        return bonus;
                    }
                },
                {
                    title: "üí™ Leg Day = Flower Day!",
                    message: "Treinou perna hoje? Suas flores cresceram r√°pido com tanta energia!",
                    effect: () => {
                        gameState.plots.forEach((plot, index) => {
                            if (plot && plot.growing) {
                                plot.progress += 20;
                                if (plot.progress >= 100) {
                                    plot.progress = 100;
                                    plot.growing = false;
                                    plot.ready = true;
                                }
                            }
                        });
                        renderGarden();
                        return 25;
                    }
                },
                {
                    title: "üî¥‚ö´ Gol do Gabigol!",
                    message: "O Flamengo marcou! Seu jardim comemorou com flores extras!",
                    effect: () => {
                        const bonus = Math.floor(Math.random() * 35) + 25;
                        gameState.coins += bonus;
                        updateStats();
                        return bonus;
                    }
                }
            ];

            const randomEvent = events[Math.floor(Math.random() * events.length)];
            gameState.eventReward = randomEvent.effect();
            
            document.getElementById('event-title').textContent = randomEvent.title;
            document.getElementById('event-message').textContent = randomEvent.message;
            if (gameState.eventReward > 0) {
                document.getElementById('event-message').textContent += ` +${gameState.eventReward} moedas!`;
            }
            document.getElementById('event-popup').classList.add('show');
            document.getElementById('overlay').classList.add('show');
        }

        function closeEventPopup() {
            document.getElementById('event-popup').classList.remove('show');
            document.getElementById('overlay').classList.remove('show');
        }

        // Show notification
        function showNotification(title, message) {
            document.getElementById('notif-title').textContent = title;
            document.getElementById('notif-message').textContent = message;
            document.getElementById('notification').classList.add('show');
            document.getElementById('overlay').classList.add('show');
        }

        function closeNotification() {
            document.getElementById('notification').classList.remove('show');
            document.getElementById('overlay').classList.remove('show');
        }

        // Update stats
        function updateStats() {
            document.getElementById('coins').textContent = gameState.coins;
            document.getElementById('flowers').textContent = gameState.flowersCollected;
            document.getElementById('photos').textContent = gameState.unlockedPhotos.length;
        }

        // Show section
        function showSection(section) {
            // Update nav buttons
            document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            // Hide all sections
            document.getElementById('garden-section').style.display = 'none';
            document.getElementById('shop-section').classList.remove('active');
            document.getElementById('missions-section').classList.remove('active');
            document.getElementById('album-section').classList.remove('active');
            
            // Show selected section
            if (section === 'garden') {
                document.getElementById('garden-section').style.display = 'block';
            } else {
                document.getElementById(section + '-section').classList.add('active');
            }
        }

        // Start game
        init();
    </script>
</body>
</html>